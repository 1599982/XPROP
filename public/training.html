<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Entrenamiento</title>

    <!-- Fuente Konkhmer Sleokchher -->
    <link
      href="https://fonts.googleapis.com/css2?family=Konkhmer+Sleokchher&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="{{ url_for('static', filename='styles/index.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/training.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/virtual-mouse-overlay.css') }}" />
  </head>
  <body>
    <!-- Título -->
    <h2 class="title">Entrenamiento</h2>

    <!-- Único cuadro azul -->
    <div class="content-box">
      <!-- Sidebar -->
      <div class="sidebar">
        <button onclick="window.location.href='/'">
          <img
            src="{{ url_for('static', filename='images/icons/home.png') }}"
            alt="Inicio"
          />
        </button>
        <button onclick="window.location.href='/previsione/alfabeto'">
          <img
            src="{{ url_for('static', filename='images/icons/letters.png') }}"
            alt="Letras"
          />
        </button>
        <button onclick="window.location.href='/previsione/numeri'">
          <img
            src="{{ url_for('static', filename='images/icons/numbers.png') }}"
            alt="Número"
          />
        </button>
        <button onclick="window.location.href='/allenamiento'">
          <img
            src="{{ url_for('static', filename='images/icons/training.png') }}"
            alt="Entrenando"
          />
        </button>
        <button onclick="window.location.href='/'">
          <img
            src="{{ url_for('static', filename='images/icons/user.png') }}"
            alt="Usuario"
          />
        </button>
      </div>

      <!-- Contenido principal -->
      <div class="main-content">
        <!-- Contenedor principal con diseño de grid -->
        <div class="layout-container">
          <!-- Sección de botones de entrenamiento - parte superior izquierda -->
          <div class="training-section">
            <div class="training-options">
              <div
                class="training-card"
                onclick="window.location.href='/allenamiento/numeri'"
              >
                <h3>Entrenar los 123</h3>
                <div class="training-icon">
                  <img
                    src="{{ url_for('static', filename='images/icons/training.png') }}"
                    alt="Entrenar números"
                  />
                </div>
              </div>

              <div
                class="training-card"
                onclick="window.location.href='allenamiento/alfabeto'"
              >
                <h3>Entrenar el ABC</h3>
                <div class="training-icon">
                  <img
                    src="{{ url_for('static', filename='images/icons/training.png') }}"
                    alt="Entrenar letras"
                  />
                </div>
              </div>
            </div>
          </div>

          <!-- Sección de video - posición según cuadro rojo (superior derecha, alto) -->
          <div class="video-section">
            <iframe
              width="100%"
              height="100%"
              src="https://www.youtube.com/embed/u-OzHcpiQ7U"
              title="¿quieres aprender Lengua de Señas Mexicana? Síguenos #lenguadeseñasmexicana #lsm #lenguajedeseñas"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              referrerpolicy="strict-origin-when-cross-origin"
              allowfullscreen
            ></iframe>
          </div>

          <!-- Sección de modelos entrenados - posición según cuadro negro (inferior izquierda) -->
          <div class="models-section">
            <h3 class="models-title">Modelos Entrenados</h3>
            <div class="models-container">
              <div class="model-item">
                <div class="model-info">
                  <span class="model-name">Abecedario</span>
                  <span class="model-percentage" id="alphabet-percentage">0%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" id="alphabet-progress" style="width: 0%"></div>
                </div>
              </div>

              <div class="model-item">
                <div class="model-info">
                  <span class="model-name">Numero</span>
                  <span class="model-percentage" id="numbers-percentage">0%</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" id="numbers-progress" style="width: 0%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Definición de constantes
      const ALPHABET = [
        "A", "B", "C", "D", "E", "F", "G", "H", "I",
        "J", "K", "L", "M", "N", "O", "P", "Q", "R",
        "S", "T", "U", "V", "W", "X", "Y", "Z"
      ];
      
      const NUMBERS = [
        "0", "1", "2", "3", "4", "5", "6", "7", "8", "9"
      ];

      // Función para calcular el progreso de entrenamiento
      async function updateTrainingProgress() {
        try {
          const response = await fetch('/api/training/progress');
          const result = await response.json();
          
          let alphabetProgress = 0;
          let numbersProgress = 0;
          
          if (result.success) {
            alphabetProgress = result.alphabet.percentage;
            numbersProgress = result.numbers.percentage;
          }
          
          // Actualizar la UI
          const alphabetPercentageEl = document.getElementById('alphabet-percentage');
          const alphabetProgressEl = document.getElementById('alphabet-progress');
          const numbersPercentageEl = document.getElementById('numbers-percentage');
          const numbersProgressEl = document.getElementById('numbers-progress');
          
          if (alphabetPercentageEl) {
            alphabetPercentageEl.textContent = `${alphabetProgress}%`;
          }
          if (alphabetProgressEl) {
            alphabetProgressEl.style.width = `${alphabetProgress}%`;
          }
          if (numbersPercentageEl) {
            numbersPercentageEl.textContent = `${numbersProgress}%`;
          }
          if (numbersProgressEl) {
            numbersProgressEl.style.width = `${numbersProgress}%`;
          }
          
        } catch (error) {
          console.error('Error al calcular el progreso de entrenamiento:', error);
          // En caso de error, mostrar 0%
          const alphabetPercentageEl = document.getElementById('alphabet-percentage');
          const alphabetProgressEl = document.getElementById('alphabet-progress');
          const numbersPercentageEl = document.getElementById('numbers-percentage');
          const numbersProgressEl = document.getElementById('numbers-progress');
          
          if (alphabetPercentageEl) alphabetPercentageEl.textContent = '0%';
          if (alphabetProgressEl) alphabetProgressEl.style.width = '0%';
          if (numbersPercentageEl) numbersPercentageEl.textContent = '0%';
          if (numbersProgressEl) numbersProgressEl.style.width = '0%';
        }
      }

      // Actualizar progreso cuando se carga la página
      document.addEventListener('DOMContentLoaded', function() {
        updateTrainingProgress();
        
        // Actualizar cada 5 segundos por si se entrenan datos en otra pestaña
        setInterval(updateTrainingProgress, 5000);
      });

      // No necesitamos escuchar localStorage ya que usamos APIs
      // Las actualizaciones se manejan mediante el intervalo de 5 segundos
    </script>

    <!-- Virtual Mouse Overlay Integration -->
    <script src="{{ url_for('static', filename='virtual-mouse-config.js') }}"></script>
    <script src="{{ url_for('static', filename='virtual-mouse-overlay.js') }}"></script>
  </body>
</html>
